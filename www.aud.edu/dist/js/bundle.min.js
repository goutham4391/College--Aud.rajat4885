$(function () {

    $(".course-loadmore, .course-search-button").on("click", function (e) {
        e.preventDefault();
        var targetElement = e.target || e.srcElement;
        var targetContainerId = $(targetElement).data("targetid");
        var targetContainer = $("#" + targetContainerId);
        var documenttypealias = targetContainer.data("documenttypealias");

        var filterbykey = targetContainer.data("filterbykey");
        var filterbyvalue = targetContainer.data("filterbyvalue");
        var itemsToSkip = targetContainer.data("skip");
        var itemsToTake = targetContainer.data("take");
        var renderAsList = targetContainer.data("renderaslist");

        var searchTerm = $("#" + targetContainerId + "-search").val();
        var action = $(targetElement).data("action");

        var params = {
            documentTypeAlias: documenttypealias,
            searchTerm: searchTerm,
            take: itemsToTake,
            skip: itemsToSkip,
            filterByKey: filterbykey,
            filterByValue: filterbyvalue,
            renderAsList: renderAsList
        };

        $.ajax({
            type: "POST",
            url: "/umbraco/surface/jsoncontent/search",
            data: JSON.stringify(params),
            contentType: "application/json",
            dataType: "json",
            success: function (data) {
                if (data != null && data.renderedView != "") {
                    if (action === "search") {
                        targetContainer.html(data.renderedView);
                        targetContainer.data("skip", data.count);
                    }
                    if (action === "loadmore") {
                        if (data.count > 0) {
                            targetContainer.append(data.renderedView);
                            targetContainer.data("skip", itemsToSkip + data.count);
                        }
                    }
                }
            }
        });
    });

    // "APPLY" filter buttons on the admission and aid page
    $(".course-filter-button").on("click", function (e) {
        e.preventDefault();

        var targetElement = e.target || e.srcElement;
        var targetElement = e.target || e.srcElement;
        var targetContainerId = $(targetElement).data("targetid");
        var targetContainer = $("#" + targetContainerId);
        var documenttypealias = targetContainer.data("documenttypealias");
        var renderAsList = targetContainer.data("renderaslist");
        var searchTerm = $("#" + targetContainerId + "-search").val();
        var interest = $("#" + targetContainerId + "-interest").val();
        var sortBy = $(targetElement).val();
        var filterToType = targetContainer.data("filtertotype");

        var interestTagGroup = "courseinterest";
        var careerTagGroup = "coursecareers";

        var interestSelector = "input[name=courseinterest]:checked";
        var careerSelector = "input[name=coursecareers]:checked";

        //pick the values from the checkboxes or fall back to default filter

        var filterToInterest = $(interestSelector).map(
            function () { return this.value; }).get().join(",");
        if (filterToInterest == "") {
            filterToInterest = targetContainer.data("filtertointerest");
        }


        var filterToCareer = $(careerSelector).map(
            function () { return this.value; }).get().join(",");

        if (filterToCareer == null) {
            filterToCareer = targetContainer.data("filtertocareer");
        }

        var params = {
            documentTypeAlias: documenttypealias,
            searchTerm: searchTerm,
            interest: interest,
            filterToType: filterToType,
            renderAsList: renderAsList,
            filterToInterest: filterToInterest,
            filterToCareer: filterToCareer,
            sortBy: sortBy
        };

        $.ajax({
            type: "POST",
            url: "/umbraco/surface/course/search",
            data: JSON.stringify(params),
            contentType: "application/json",
            dataType: "json",
            success: function (data) {
                if (data != null && data.renderedView != "") {
                    $("#" + targetContainerId).html(data.renderedView);
                }
            }
        });
    });

    $(".all-courses").on("click", function (e) {
        e.preventDefault();

        var interestSelector = "input[name=courseinterest]:checked";
        var careerSelector = "input[name=coursecareers]:checked";

        $(interestSelector).removeAttr('checked');
        $(careerSelector).removeAttr('checked');
    });

    //Admission and Aid Interest & career filters
    $(".sort-control").on("change", function (e) {
        e.preventDefault();

        var targetElement = e.target || e.srcElement;
        var targetContainerId = $(targetElement).data("targetid");
        var targetContainer = $("#" + targetContainerId);
        var documenttypealias = targetContainer.data("documenttypealias");

        var filterbykey = targetContainer.data("filterbykey");
        var filterbyvalue = targetContainer.data("filterbyvalue");
        var itemsToSkip = targetContainer.data("skip");
        var itemsToTake = targetContainer.data("take");

        var searchTerm = $("#" + targetContainerId + "-search").val();
        var sortBy = $(targetElement).val();

        var taggroup = $(targetElement).data("taggroup");
        var selector = "input[name=" + taggroup + "]:checked";
        var tags = $(selector).map(
            function () { return this.value; }).get().join(",");

        var params = {
            documentTypeAlias: documenttypealias,
            searchTerm: searchTerm,
            take: itemsToTake,
            skip: itemsToSkip,
            filterByKey: filterbykey,
            filterByValue: filterbyvalue,
            tagGroup: taggroup,
            tags: tags,
            sortBy: sortBy
        };

        $.ajax({
            type: "POST",
            url: "/umbraco/surface/jsoncontent/GetContentByTags",
            data: JSON.stringify(params),
            contentType: "application/json",
            dataType: "json",
            success: function (data) {
                if (data != null && data.renderedView != "") {
                    $("#" + targetContainerId).html(data.renderedView);
                }
            }
        });
    });

    //When the currently selected filter changes
    $(".filter-control").on("change", function (e) {
        e.preventDefault();
        var targetElement = e.target || e.srcElement;
        var targetContainerId = $(targetElement).data("targetid");
        var targetContainer = $("#" + targetContainerId);
        var documenttypealias = targetContainer.data("documenttypealias");
        var filterbykey = targetContainer.data("filterbykey");
        var filterbyvalue = targetContainer.data("filterbyvalue");
        var renderAsList = targetContainer.data("renderaslist");

        var searchTerm = $("#" + targetContainerId + "-search").val();
        var taggroup = $(targetElement).data("taggroup");

        var selector = ".filter-control";
        var filterQuery = "";

        var tags = $(selector).map(
            function () { (this.name + "=" + this.value) }).get().join(";");

        var params = {
            documentTypeAlias: documenttypealias,
            searchTerm: searchTerm,
            filterByKey: filterbykey,
            filterByValue: filterbyvalue,
            tagGroup: taggroup,
            tags: tags,
            renderAsList: renderAsList
        };

        $.ajax({
            type: "POST",
            url: "/umbraco/surface/content/GetContentByTags",
            data: JSON.stringify(params),
            contentType: "application/json",
            dataType: "json",
            success: function (data) {
                if (data != null && data.renderedView != "") {
                    $("#" + targetContainerId).html(data.renderedView);
                }
            }
        });
    });

    //Course components
    $(".course-filter-control").on("change click", function (e) {
        e.preventDefault();
        var targetElement = e.target || e.srcElement;
        var targetContainerId = $(targetElement).data("targetid");
        var targetContainer = $("#" + targetContainerId);
        var interestfilterenabled = targetContainer.data("interestfilterenabled");
        var interestFilterSelector = targetContainerId + "-interest";

        var params = getParameters(e);
        fetch(params, renderContent);
        function renderContent(data) {
            if (data != null && data.renderedView != "") {
                //populate the target container with rendererd view
                targetContainer.html(data.renderedView);

                //if the request wasn't from the interest filter
                if (targetElement.id != interestFilterSelector) {
                    var output = [];
                    output.push('<option value="">All</option>');
                    $.each(data.interestTags, function (key, value) {
                        output.push('<option value="' + value + '">' + value + '</option>');
                    });
                    $("#" + targetContainerId + "-interest").html(output.join(''));
                }
            };
        }

    });

    $(".course-sort-control").on("change", function (e) {
        e.preventDefault();
        var params = getParameters(e);
        var targetElement = e.target || e.srcElement;
        
        var targetContainerId = $(targetElement).data("targetid");
        fetch(params, renderContent);

        function renderContent(data) {
            if (data != null && data.renderedView != "") {
                $("#" + targetContainerId).html(data.renderedView);
            }
        }
    });
    function getParameters(e) {
        var targetElement = e.target || e.srcElement;
        var targetContainerId = $(targetElement).data("targetid");
        var targetContainer = $("#" + targetContainerId);

        var documenttypealias = targetContainer.data("documenttypealias");
        var renderAsList = targetContainer.data("renderaslist");
        var searchTerm = $("#" + targetContainerId + "-search").val();

        var interest = $("#" + targetContainerId + "-interest").val();

        var sortBy = $(targetElement).val();
        var filterToType = targetContainer.data("filtertotype");
        var filterToInterest = targetContainer.data("filtertointerest");
        var filterToCareer = targetContainer.data("filtertocareer");
        var filterToSchool = targetContainer.data("school");
        var itemsToTake = targetContainer.data("take");
        
        if (filterToType == "") {
            filterToType = $("#" + targetContainerId + "-filtertotype").val();
        }

        if (filterToInterest == "") {
            filterToInterest = $("#" + targetContainerId + "-interest").val();
        }

        var params = {
            documentTypeAlias: documenttypealias,
            searchTerm: searchTerm,
            interest: interest,
            filterToType: filterToType,
            renderAsList: renderAsList,
            filterToInterest: filterToInterest,
            filterToCareer: filterToCareer,
            sortBy: sortBy,
            filterToSchool: filterToSchool,
            take: itemsToTake,
        };
        return params;
    }

    function fetch(parameters, callback) {
        $.ajax({
            type: "POST",
            url: "/umbraco/surface/course/search",
            data: JSON.stringify(parameters),
            contentType: "application/json",
            dataType: "json",
            success: callback
        });
    }
});
$(function () {

    $(".loadmore,.search-button").on("click", function (e) {
        e.preventDefault();
        var targetElement = e.target || e.srcElement;
        var targetContainerId = $(targetElement).data("targetid");
        var targetContainer = $("#" + targetContainerId);
        var documenttypealias = targetContainer.data("documenttypealias");

        var filterbykey = targetContainer.data("filterbykey");
        var filterbyvalue = targetContainer.data("filterbyvalue");
        var itemsToSkip = targetContainer.data("skip");
        var itemsToTake = targetContainer.data("take");
        var renderAsList = targetContainer.data("renderaslist");

        var searchTerm = $("#" + targetContainerId + "-search").val();
        var action = $(targetElement).data("action");

        var params = {
            documentTypeAlias: documenttypealias,
            searchTerm: searchTerm,
            take: itemsToTake,
            skip: itemsToSkip,
            filterByKey: filterbykey,
            filterByValue: filterbyvalue,
            renderAsList: renderAsList
        };

        $.ajax({
            type: "POST",
            url: "/umbraco/surface/jsoncontent/search",
            data: JSON.stringify(params),
            contentType: "application/json",
            dataType: "json",
            success: function (data) {
                if (data != null && data.renderedView != "") {
                    if (action === "search") {
                        targetContainer.html(data.renderedView);
                        targetContainer.data("skip", data.count);
                    }
                    if (action === "loadmore") {
                        if (data.count > 0) {
                            targetContainer.append(data.renderedView);
                            targetContainer.data("skip", itemsToSkip + data.count);
                        }
                    }
                }
            }
        });
    });

    $(".filter-button").on("click", function (e) {
        e.preventDefault();
        var targetElement = e.target || e.srcElement;

        var itemsToSkip = $(targetElement).data("skip");
        var itemsToTake = $(targetElement).data("take");
        var documenttypealias = $(targetElement).data("documenttypealias");
        var targetContainerId = $(targetElement).data("targetid");
        var filterbykey = $(targetElement).data("filterbykey");
        var filterbyvalue = $(targetElement).data("filterbyvalue");
        var searchTerm = $("#" + targetContainerId + "-search").val();
        var action = $(targetElement).data("action");
        var taggroup = $(targetElement).data("taggroup");

        var selector = "input[name=" + taggroup + "]:checked";
        var tags = $(selector).map(
            function () { return this.value; }).get().join(",");

        var params = {
            documentTypeAlias: documenttypealias,
            searchTerm: searchTerm,
            take: itemsToTake,
            skip: itemsToSkip,
            filterByKey: filterbykey,
            filterByValue: filterbyvalue,
            tagGroup: taggroup,
            tags: tags
        };

        $.ajax({
            type: "POST",
            url: "/umbraco/surface/content/GetContentByTags",
            data: JSON.stringify(params),
            contentType: "application/json",
            dataType: "json",
            success: function (data) {
                if (data != null && data.renderedView != "") {
                    $("#" + targetContainerId).html(data.renderedView);
                }
            }
        });
    });

    //Admission and Aid Interest & career filters
    $(".sort-control").on("change", function (e) {
        e.preventDefault();

        var targetElement = e.target || e.srcElement;
        var targetContainerId = $(targetElement).data("targetid");
        var targetContainer = $("#" + targetContainerId);
        var documenttypealias = targetContainer.data("documenttypealias");

        var filterbykey = targetContainer.data("filterbykey");
        var filterbyvalue = targetContainer.data("filterbyvalue");
        var itemsToSkip = targetContainer.data("skip");
        var itemsToTake = targetContainer.data("take");

        var searchTerm = $("#" + targetContainerId + "-search").val();
        var sortBy = $(targetElement).val();

        var taggroup = $(targetElement).data("taggroup");
        var selector = "input[name=" + taggroup + "]:checked";
        var tags = $(selector).map(
            function () { return this.value; }).get().join(",");

        var params = {
            documentTypeAlias: documenttypealias,
            searchTerm: searchTerm,
            take: itemsToTake,
            skip: itemsToSkip,
            filterByKey: filterbykey,
            filterByValue: filterbyvalue,
            tagGroup: taggroup,
            tags: tags,
            sortBy: sortBy
        };

        $.ajax({
            type: "POST",
            url: "/umbraco/surface/jsoncontent/GetContentByTags",
            data: JSON.stringify(params),
            contentType: "application/json",
            dataType: "json",
            success: function (data) {
                if (data != null && data.renderedView != "") {
                    $("#" + targetContainerId).html(data.renderedView);
                }
            }
        });
    });

    //When the currently selected filter changes
    $(".filter-control").on("change", function (e) {
        e.preventDefault();
        var targetElement = e.target || e.srcElement;
        var targetContainerId = $(targetElement).data("targetid");
        var targetContainer = $("#" + targetContainerId);
        var documenttypealias = targetContainer.data("documenttypealias");
        var filterbykey = targetContainer.data("filterbykey");
        var filterbyvalue = targetContainer.data("filterbyvalue");
        var renderAsList = targetContainer.data("renderaslist");

        var searchTerm = $("#" + targetContainerId + "-search").val();
        var taggroup = $(targetElement).data("taggroup");

        var selector = ".filter-control";
        var filterQuery = "";

        var tags = $(selector).map(
            function () { (this.name + "=" + this.value) }).get().join(";");

        var params = {
            documentTypeAlias: documenttypealias,
            searchTerm: searchTerm,

            filterByKey: filterbykey,
            filterByValue: filterbyvalue,
            tagGroup: taggroup,
            tags: tags,
            renderAsList: renderAsList
        };

        $.ajax({
            type: "POST",
            url: "/umbraco/surface/content/GetContentByTags",
            data: JSON.stringify(params),
            contentType: "application/json",
            dataType: "json",
            success: function (data) {
                if (data != null && data.renderedView != "") {
                    $("#" + targetContainerId).html(data.renderedView);
                }
            }
        });
    });

    //When the subscription button 
    $('.subcribe_to_newsletter').click(function (e) {
        e.preventDefault();
        var email = $("#email").val();
        var antiforgery = $("[name=__RequestVerificationToken]").val()

        if (!validateEmail(email)) {
            $("#subscribe_message").html('Invalid Email Address');
            $("#email").attr('class', 'error-input');
            return;
        } else {
            $("#subscribe_message").html('');
            $("#email").attr('class', 'subscribe-input w100');
        }

        if (antiforgery == null || antiforgery == "") {
            $("#invalid_token").html('Invalid token, kindly reload your page');
            return;
        } else {
            $("#invalid_token").html('');
        }

        var params = {
            email: email,
            __RequestVerificationToken: antiforgery
        };

        $.ajax({
            type: "POST",
            url: "/umbraco/surface/contactformsurface/emailsubcription",
            data: params,
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            dataType: "json",

            beforeSend: function () {
                $('.subcribe_to_newsletter').text("Sending ....")
                $('.subcribe_to_newsletter').attr('disabled', true);
            },

            success: function (data) {
                $("#subscribe_message").html(data.message);
            },

            error: function (x, h, error) {
                $("#subscribe_message").html("Unable to complete your request at the moment");
                $('.subcribe_to_newsletter').text('Subscribe');
                $('.subcribe_to_newsletter').removeAttr('disabled');
            }
        }).done(function () {
            $('.subcribe_to_newsletter').text('Subscribe');
            $('.subcribe_to_newsletter').removeAttr('disabled');
        });
        function validateEmail(email) {
            var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(String(email).toLowerCase());
        };
    });
     

    //When the contact us button 
    $('.contact_us').click(function (e) {
        e.preventDefault();

        var name = $("#Name").val();
        var number = $("#ContactNumber").val();
        var email = $("#Email").val();
        var country = $("#Country").val();
        var purpose = $("#Purpose").val();
        var message = $("#Message").val();

        var antiforgery = $("[name=__RequestVerificationToken]").val();

        //var recaptcha = grecaptcha.getResponse();

        // -- Form Validations --
        if (name == null || name == "") {
            $("#error_name").html('Enter Name');
            $("#Name").attr('class', 'error-input');
            return;
        } else {
            $("#error_name").html('');
            $("#Name").attr('class', 'subscribe-input w100');
        }

        if (number == null || number == "") {
            $("#error_phone").html('Enter Phone Number');
            $("#ContactNumber").attr('class', 'error-input');
            return;
        } else {
            $("#error_phone").html('');
            $("#ContactNumber").attr('class', 'subscribe-input w100');
        }

        if (!validateEmail(email)) {
            $("#error_email").html('Enter a valid email');
            $("#Email").attr('class', 'error-input');
            return;
        } else {
            $("#error_email").html('');
            $("#Email").attr('class', 'subscribe-input w100');
        }

        if (purpose == null || purpose == "") {
            $("#error_purpose").html('Select A Purpose');
            return;
        } else {
            $("#error_purpose").html('');
        }

        if (country == null || country == "") {
            $("#error_country").html('Select A Country');
            return;
        } else {
            $("#error_country").html('');
        }


        if (message == null || message == "") {
            $("#error_message").html('Enter Message');
            $("#Message").attr('class', 'error-input');
            return;
        } else {
            $("#error_message").html('');
            $("#Message").attr('class', 'subscribe-input w100');
        }


        //if (recaptcha == null || recaptcha == "") {
         //   $("#contact_form_message").html('Invalid recaptcha, kindly reload your page');
         //   $("#recaptcha_error_message").html('Invalid recaptcha, kindly reload your page');
         //   return;
        //} else {
        //    $("#contact_form_message").html('');
         //   $("#recaptcha_error_message").html('');
        //}

        //if (antiforgery == null || antiforgery == "") {
        //    $("#contact_form_message").html('Invalid token, kindly reload your page');
        //    return;
        //} else {
        //    $("#contact_form_message").html('');
        //}

        var params = {
            name: name,
            contactNumber: number,
            email: email,
            purpose: purpose,
            message: message,
            country: country,
            __RequestVerificationToken: antiforgery
        };

        $.ajax({
            type: "POST",
            url: "/umbraco/surface/contactformsurface/submitcontactform",
            data: params,
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            dataType: "json",
            beforeSend: function () {
                $('.contact_us').text("Sending ....");
                $('.contact_us').attr('disabled', true);
            },
            success: function (data) {

                $("#contact_form_message").html(data.message);
                $("#contact_form_message").attr('class', 'text-info');

                //Footer Confirmation..
                $("#confirmation_message").html(data.message);
                $("#confirmation_message").attr('class', 'text-info');

                $("#Name").val("");
                $("#ContactNumber").val("");
                $("#Email").val("");
                $("#Purpose").val(""); 
                $("#Message").val("");
            },
            error: function (x, h, error) {
                $("#contact_form_message").html("Unable to complete your request at the moment");
                $("#contact_form_message").attr('class', 'error-input');

                //Footer Message..
                $("#confirmation_message").html("Unable to complete your request at the moment");
                $("#confirmation_message").attr('class', 'error-info');

                $('.contact_us').text('SEND');
                $('.contact_us').removeAttr('disabled');
            }
        }).done(function () {
            $('.contact_us').text('SEND');
            $('.contact_us').removeAttr('disabled');
        });

        function validateEmail(email) {
            var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(String(email).toLowerCase());
        }
    });


    //When the twitter social media load more button is clicked
    $(".loadmore-twitter-feeds").on("click", function (e) {
        e.preventDefault();

        var pageNumber = $("#twitterPageNumber").val();
        var numberOfFeeds = $("#twitterNumberOfFeeds").val();
        var excludeReplies = $("#ExcludeReplies").val();
        var includeRetweets = $("#IncludeRetweets").val();
        var twitterHandle = $("#TwitterHandle").val();

        var params = {
            pageNumber: pageNumber,
            excludeReplies: excludeReplies,
            numberOfFeeds: numberOfFeeds,
            includeRetweets: includeRetweets,
            twitterHandle: twitterHandle
        };

        $.ajax({
            type: "POST",
            url: "/umbraco/surface/SocialFeeds/LoadMoreTweets",
            data: JSON.stringify(params),
            contentType: "application/json",
            dataType: "json",
            beforeSend: function () {
                $('.loadmore-twitter-feeds').text("Loading ....");
                $('.loadmore-twitter-feeds').attr('disabled', true);
            },
            success: function (data) {

                $('.twitter-loadmore-container').html(data.loadmoreview);
                $("#twitterPageNumber").val(data.pageNumber); 

            },
            error: function (x, h, error) {
                console.log(error);
                $('.loadmore-twitter-feeds').text('Load more');
                $('.loadmore-twitter-feeds').removeAttr('disabled');
            }
        }).done(function () {
            $('.loadmore-twitter-feeds').text('Load more');
            $('.loadmore-twitter-feeds').removeAttr('disabled');
        });

    });



    //When the instagram social media load more button is clicked
    $(".loadmore-instagram-feeds").on("click", function (e) {
        e.preventDefault();

        var pageNumber = $("#instagramPageNumber").val(); 
        var numberOfFeeds = $("#instagramNumberOfFeeds").val(); 
        var instagramHandle = $("#instagramHandle").val();

        var params = {
            pageNumber: pageNumber, 
            numberOfFeeds: numberOfFeeds, 
            instagramHandle: instagramHandle
        };

        $.ajax({
            type: "POST",
            url: "/umbraco/surface/SocialFeeds/LoadMoreInstagramFeeds",
            data: JSON.stringify(params),
            contentType: "application/json",
            dataType: "json",
            beforeSend: function () {
                $('.loadmore-instagram-feeds').text("Loading ....");
                $('.loadmore-instagram-feeds').attr('disabled', true);
            },
            success: function (data) {

                $('.instagram-loadmore-container').html(data.loadmoreview);
                $("#instagramPageNumber").val(data.pageNumber);

            },
            error: function (x, h, error) {
                console.log(error);
                $('.loadmore-instagram-feeds').text('Load more');
                $('.loadmore-instagram-feeds').removeAttr('disabled');
            }
        }).done(function () {
            $('.loadmore-instagram-feeds').text('Load more');
            $('.loadmore-instagram-feeds').removeAttr('disabled');
        });

    });
});
$(function () {

    //Course components
    $(".find-grouped, .grouped-sort-control").on("change click", function (e) {
        e.preventDefault();
        var targetElement = e.target || e.srcElement;
        var targetContainerId = $(targetElement).data("targetid");
        var targetContainer = $("#" + targetContainerId);
        
        var params = getParameters(e);
        fetch(params, renderContent);
        function renderContent(data) {
            if (data != null && data.renderedView != "") {
                //populate the target container with rendererd view
                targetContainer.html(data.renderedView);
                
            };
        }

    });

    function getParameters(e) {
        var targetElement = e.target || e.srcElement;
        var targetContainerId = $(targetElement).data("targetid");
        var targetContainer = $("#" + targetContainerId);

        var documenttypealias = targetContainer.data("documenttypealias");
        
        var searchTerm = $("#" + targetContainerId + "-search").val();
        var sortBy = $("#" + targetContainerId + "-sort").val();
        var filterByKey = targetContainer.data("groupby");
        var filterByValue = $("#" + targetContainerId + "-filter").val();
        
        var groupBy = targetContainer.data("groupby");

        var params = {
            documentTypeAlias: documenttypealias,
            searchTerm: searchTerm,
            sortBy: sortBy,
            groupBy: groupBy,
            filterByKey: filterByKey,
            filterByValue: filterByValue
        };
        return params;
    }

    function fetch(parameters, callback) {
        $.ajax({
            type: "POST",
            url: "/umbraco/surface/groupedcontent/search",
            data: JSON.stringify(parameters),
            contentType: "application/json",
            dataType: "json",
            success: callback
        });
    }

});